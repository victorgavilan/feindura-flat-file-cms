/*
 Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function x(c){return CKEDITOR.env.ie?c.$.clientWidth:parseInt(c.getComputedStyle("width"),10)}function w(c,i){var a=c.getComputedStyle("border-"+i+"-width"),h={thin:"0px",medium:"1px",thick:"2px"};if(a.indexOf("px")<0)a=a in h&&c.getComputedStyle("border-style")!="none"?h[a]:0;return parseInt(a,10)}function I(c){var i=[],a=-1,h=c.getComputedStyle("direction")=="rtl",f;f=c.$.rows;for(var o=0,d,g,e,j=0,p=f.length;j<p;j++){e=f[j];d=e.cells.length;if(d>o){o=d;g=e}}f=g;o=new CKEDITOR.dom.element(c.$.tBodies[0]);
d=o.getDocumentPosition();g=0;for(e=f.cells.length;g<e;g++){j=new CKEDITOR.dom.element(f.cells[g]);p=f.cells[g+1]&&new CKEDITOR.dom.element(f.cells[g+1]);a+=j.$.colSpan||1;var l,r,m=j.getDocumentPosition().x;h?r=m+w(j,"left"):l=m+j.$.offsetWidth-w(j,"right");if(p){m=p.getDocumentPosition().x;h?l=m+p.$.offsetWidth-w(p,"right"):r=m+w(p,"left")}else{m=c.getDocumentPosition().x;h?l=m:r=m+c.$.offsetWidth}i.push({table:c,index:a,x:l,y:d.y,width:Math.max(r-l,3),height:o.$.offsetHeight,rtl:h})}return i}function A(c){(c.data||
c).preventDefault()}function J(c){function i(){j=0;e.setOpacity(0);l&&a();var b=d.table;setTimeout(function(){b.removeCustomData("_cke_table_pillars")},0);g.removeListener("dragstart",A)}function a(){for(var b=d.rtl,B=b?m.length:r.length,u=0;u<B;u++){var v=r[u],q=m[u],s=d.table;CKEDITOR.tools.setTimeout(function(y,z,C,k,n,E){y&&y.setStyle("width",t(Math.max(z+E,0)));C&&C.setStyle("width",t(Math.max(k-E,0)));if(n)s.setStyle("width",t(n+E*(b?-1:1)))},0,this,[v,v&&x(v),q,q&&x(q),(!v||!q)&&x(s)+w(s,"left")+
w(s,"right"),l])}}function h(b){A(b);b=d.index;for(var B=CKEDITOR.tools.buildTableMap(d.table),u=[],v=[],q=Number.MAX_VALUE,s=q,y=d.rtl,z=0,C=B.length;z<C;z++){var k=B[z],n=k[b+(y?1:0)];k=k[b+(y?0:1)];n=n&&new CKEDITOR.dom.element(n);k=k&&new CKEDITOR.dom.element(k);if(!n||!k||!n.equals(k)){n&&(q=Math.min(q,x(n)));k&&(s=Math.min(s,x(k)));u.push(n);v.push(k)}}r=u;m=v;F=d.x-q;G=d.x+s;e.setOpacity(0.5);p=parseInt(e.getStyle("left"),10);l=0;j=1;e.on("mousemove",o);g.on("dragstart",A);g.on("mouseup",f,
this)}function f(b){b.removeListener();i()}function o(b){K(b.data.getPageOffset().x)}var d,g,e,j,p,l,r,m,F,G;g=c.document;e=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',g);D||g.getDocumentElement().append(e);this.attachTo=function(b){if(!j){if(D){g.getBody().append(e);l=0}d=b;e.setStyles({width:t(b.width),
height:t(b.height),left:t(b.x),top:t(b.y)});D&&e.setOpacity(0.25);e.on("mousedown",h,this);g.getBody().setStyle("cursor","col-resize");e.show()}};var K=this.move=function(b){if(!d)return 0;if(!j&&(b<d.x||b>d.x+d.width)){d=null;j=l=0;g.removeListener("mouseup",f);e.removeListener("mousedown",h);e.removeListener("mousemove",o);g.getBody().setStyle("cursor","auto");D?e.remove():e.hide();return 0}b=b-Math.round(e.$.offsetWidth/2);if(j){if(b==F||b==G)return 1;b=Math.max(b,F);b=Math.min(b,G);l=b-p}e.setStyle("left",
t(b));return 1}}function H(c){var i=c.data.getTarget();if(c.name=="mouseout"){if(!i.is("table"))return;for(var a=new CKEDITOR.dom.element(c.data.$.relatedTarget||c.data.$.toElement);a&&a.$&&!a.equals(i)&&!a.is("body");)a=a.getParent();if(!a||a.equals(i))return}i.getAscendant("table",1).removeCustomData("_cke_table_pillars");c.removeListener()}var t=CKEDITOR.tools.cssLength,D=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks);CKEDITOR.plugins.add("tableresize",{requires:"tabletools",init:function(c){c.on("contentDom",
function(){var i;c.document.getBody().on("mousemove",function(a){a=a.data;var h=a.getPageOffset().x;if(i&&i.move(h))A(a);else{a=a.getTarget();var f;if(a.is("table")||a.getAscendant("tbody",1)){f=a.getAscendant("table",1);if(!(a=f.getCustomData("_cke_table_pillars"))){f.setCustomData("_cke_table_pillars",a=I(f));f.on("mouseout",H);f.on("mousedown",H)}a:{f=0;for(var o=a.length;f<o;f++){var d=a[f];if(h>=d.x&&h<=d.x+d.width){h=d;break a}}h=null}if(h){!i&&(i=new J(c));i.attachTo(h)}}}})})}})})();
