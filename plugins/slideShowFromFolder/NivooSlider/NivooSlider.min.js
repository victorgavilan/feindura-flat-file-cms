var NivooSlider=new Class({Implements:[Events,Options],caption:null,children:null,containerSize:0,count:0,currentSlide:0,currentImage:"",effects:{common:["fade","fold"],horizontal:["sliceLeftUp","sliceLeftDown","sliceLeftRightDown","sliceLeftRightUp","sliceRightDown","sliceRightUp","wipeDown","wipeUp"],vertical:["sliceDownLeft","sliceDownRight","sliceUpDownLeft","sliceUpDownRight","sliceUpLeft","sliceUpRight","wipeLeft","wipeRight"]},holder:null,hover:false,interval:null,orientation:"",paused:false,running:false,slices:null,sliceSize:null,totalSlides:0,options:{animSpeed:500,autoPlay:true,controlNav:true,controlNavItem:"disc",directionNav:true,directionNavHide:false,directionNavPosition:"inside",directionNavWidth:"20%",effect:"sliceDown",interval:3000,orientation:"vertical",pauseOnHover:true,slices:15,preLoadImages:false},initialize:function(a,b){this.container=$(a);this.setOptions(b);this.orientation=this.options.orientation;this.effects.horizontal.combine(this.effects.common);this.effects.vertical.combine(this.effects.common);this.initSlider();this.createSlices();if(this.options.autoPlay){this.play()}},animate:function(e,d,b){var a=e.retrieve("fxInstance"),c=b!==undefined&&b===true;a.start(d).chain(function(){this.count+=1;if(this.count===this.options.slices||c){this.running=false;this.finish();this.setBackgroundImage();this.count=0;if(this.currentSlide===(this.totalSlides-1)){this.lastSlide()}}}.bind(this))},arrangeSlices:function(c){var b,a,e,d;this.slices.each(function(g,f){a={left:c==="vertical"?this.sliceSize.x*f:0,top:c==="horizontal"?this.sliceSize.y*f:0};if(c==="horizontal"){b=f===this.options.slices-1?this.containerSize.y-(this.sliceSize.y*f):this.sliceSize.y;d="100%";g.setStyles({height:b,top:a.top,width:d})}else{b=0;d=f===this.options.slices-1?this.containerSize.x-(this.sliceSize.x*f):this.sliceSize.x;g.setStyles({height:b,left:a.left,top:"",width:d})}g.store("fxInstance",new Fx.Morph(g,{duration:this.options.animSpeed})).store("coordinates",Object.merge(a,{height:b,width:d}))},this)},createCaption:function(){this.caption=new Element("p",{styles:{opacity:0}}).inject(this.holder);this.caption.store("fxInstance",new Fx.Morph(this.caption,{duration:200,wait:false}))},createControlNav:function(){var a="",c,b=1;this.container.addClass("got-control-nav");new Element("div.control-nav").inject(this.container);this.totalSlides.each(function(d){if(this.options.controlNavItem==="decimal"){c=b;b++}else{if(this.options.controlNavItem==="disc"){a="decimal";c="&bull;"}else{c=this.options.controlNavItem}}new Element("a",{"class":a,events:{click:function(f){f.stop();this.slide(d)}.bind(this)},href:"#",html:c}).inject(this.container.getElement("div.control-nav"))},this);this.setCurrentControlItem()},createDirectionNav:function(){var a,d,b,e,c;e=this.options.directionNavPosition==="inside"?this.holder:this.container;c=this.options.directionNavWidth;a={height:this.containerSize.y};if(this.options.directionNavPosition==="inside"&&this.options.directionNavWidth.toInt()!==0){a.width=c}d=new Element("div.direction-nav-left",{styles:a}).inject(e);b=new Element("div.direction-nav-right",{styles:a}).inject(e);this.leftNav=new Element("a",{events:{click:function(f){f.stop();if(this.options.autoPlay){this.pause();if(!this.options.pauseOnHover){this.play()}}this.previous()}.bind(this)},href:"#",styles:{height:a.height}}).inject(d);this.rightNav=new Element("a",{events:{click:function(f){f.stop();if(this.options.autoPlay){this.pause();if(!this.options.pauseOnHover){this.play()}}this.next()}.bind(this)},href:"#",styles:{height:a.height}}).inject(b);if(this.options.directionNavHide&&this.options.directionNav){$$(this.leftNav,this.rightNav).setStyle("opacity",0);this.holder.addEvents({mouseout:function(){$$(this.leftNav,this.rightNav).fade(0)}.bind(this),mouseover:function(){$$(this.leftNav,this.rightNav).fade(1)}.bind(this)})}},createLinkHolder:function(){this.linkHolder=new Element("a.nivoo-link",{href:"#"}).inject(this.holder)},createSlices:function(){this.sliceSize={x:(this.containerSize.x/this.options.slices).round(),y:(this.containerSize.y/this.options.slices).round()};if(["fade","wipeLeft","wipeRight"].contains(this.options.effect)){this.options.slices=1}this.options.slices.each(function(a){new Element("div.nivoo-slice").inject(this.holder)},this);this.slices=this.getSlices();this.arrangeSlices(this.options.orientation)},getImages:function(){return this.holder.getElements("img")},getSlices:function(){return this.holder.getElements(".nivoo-slice")},initSlider:function(){if(this.options.directionNavPosition==="outside"){this.container.addClass("direction-nav-outside")}this.holder=new Element("div.nivoo-slider-holder").adopt(this.container.getChildren()).inject(this.container);this.containerSize=this.holder.getParent(".nivoo-slider").getSize();this.children=this.getImages();this.totalSlides=this.children.length;this.children.setStyle("display","none");this.currentImage=this.children[0];this.createLinkHolder();this.setLink();this.holder.setStyle("background-image",'url("'+this.currentImage.get("src")+'")');this.createCaption();this.showCaption();if(this.options.pauseOnHover&&this.options.autoPlay){this.holder.addEvents({mouseenter:function(){this.pause()}.bind(this),mouseleave:function(){this.play()}.bind(this)})}if(this.options.directionNav){this.createDirectionNav()}if(this.options.controlNav){this.createControlNav()}},hideCaption:function(){this.caption.retrieve("fxInstance").start({bottom:this.caption.getHeight()*-1,opacity:0.5})},next:function(){this.currentSlide+=1;if(this.currentSlide===this.totalSlides){this.currentSlide=0}this.slide()},pause:function(){window.clearInterval(this.interval)},play:function(){this.interval=this.next.periodical(this.options.interval,this)},previous:function(){if(this.options.autoPlay){this.pause();if(!this.options.pauseOnHover){this.play()}}this.currentSlide-=1;if(this.currentSlide<0){this.currentSlide=(this.totalSlides-1)}this.slide()},setCurrentControlItem:function(){var a=this.container.getElement("div.control-nav a.current");if(a){a.removeClass("current")}this.container.getElements("div.control-nav a")[this.currentSlide].addClass("current")},showCaption:function(){var a=this.currentImage.get("title");if(!a){this.hideCaption();return}this.setCaptionText(a);this.caption.retrieve("fxInstance").start({bottom:0,opacity:1})},slide:function(c){var h,d,b,g,f,e,a;if(this.running){return}if(this.options.orientation==="random"){b=["horizontal","vertical"].getRandom()}else{b=this.options.orientation}if(b!==this.orientation){this.arrangeSlices(b);this.orientation=b}if(c!==undefined){this.currentSlide=c}this.currentImage=this.children[this.currentSlide];if(this.options.controlNav){this.setCurrentControlItem()}this.setLink();this.showCaption();f=this.slices;a=0;this.slices.each(function(j){h=j.retrieve("coordinates");j.setStyles({background:'url("'+this.currentImage.get("src")+'") no-repeat -'+h.left+"px "+h.top*-1+"px",bottom:"",height:h.height,left:h.left,opacity:0,right:"",top:h.top,width:h.width});var i=b==="horizontal"?"width":"height";j.setStyle(i,0)},this);this.start();this.running=true;d=this.options.effect;if(d==="random"){d=this.effects[b].getRandom()}if(["sliceDownRight","sliceDownLeft"].contains(d)){if(d==="sliceDownLeft"){f=f.reverse()}f.each(function(i){i.setStyle("top",0);this.animate.delay(100+a,this,[i,{height:this.containerSize.y,opacity:1}]);a+=50},this)}else{if(["sliceUpRight","sliceUpLeft"].contains(d)){if(d==="sliceUpLeft"){f=f.reverse()}f.each(function(j){var i=j.retrieve("fxInstance");j.setStyle("bottom",0);this.animate.delay(100+a,this,[j,{height:this.containerSize.y,opacity:1}]);a+=50},this)}else{if(["sliceUpDownRight","sliceUpDownLeft"].contains(d)){if(d==="sliceUpDownLeft"){f=f.reverse()}f.each(function(k,j){if(j%2===0){k.setStyle("top",0)}else{k.setStyles({bottom:0,top:""})}this.animate.delay(100+a,this,[k,{height:this.containerSize.y,opacity:1}]);a+=50},this)}else{if(["wipeLeft","wipeRight"].contains(d)){e={height:this.containerSize.y,opacity:1,width:0};if(d==="wipeRight"){Object.append(e,{backgroundPosition:"top right",left:"",right:0})}g=f[0];g.setStyles(e);this.animate(g,{width:this.containerSize.x},true)}else{if(["sliceLeftUp","sliceLeftDown","sliceRightDown","sliceRightUp"].contains(d)){if(d==="sliceLeftUp"||d==="sliceRightUp"){f=f.reverse()}if(d==="sliceRightDown"||d==="sliceRightUp"){f.setStyles({left:"",right:0})}else{f.setStyles({left:0,right:""})}f.each(function(i){this.animate.delay(100+a,this,[i,{opacity:1,width:this.containerSize.x}]);a+=50},this)}else{if(["sliceLeftRightDown","sliceLeftRightUp"].contains(d)){if(d==="sliceLeftRightUp"){f=f.reverse()}f.each(function(k,j){if(j%2===0){k.setStyles({left:0,right:""})}else{k.setStyles({left:"",right:0})}this.animate.delay(100+a,this,[k,{opacity:1,width:this.containerSize.x}]);a+=50},this)}else{if(["wipeDown","wipeUp"].contains(d)){e={height:0,opacity:1,width:this.containerSize.x};if(d==="wipeUp"){Object.append(e,{backgroundPosition:"bottom left",bottom:0,top:""})}g=f[0];g.setStyles(e);this.animate(g,{height:this.containerSize.y},true)}else{if(d==="fold"){f.each(function(j){var i={opacity:1};if(b==="horizontal"){i.height=j.getHeight();j.setStyles({height:0,width:this.containerSize.x})}else{i.width=j.getWidth();j.setStyles({height:this.containerSize.y,top:0,width:0})}this.animate.delay(100+a,this,[j,i]);a+=50},this)}else{g=f[0];g.setStyles({height:this.containerSize.y,width:this.containerSize.x});this.animate(g,{opacity:1},true)}}}}}}}}},setBackgroundImage:function(){this.holder.setStyle("background-image",'url("'+this.currentImage.get("src")+'")')},setCaptionText:function(a){this.caption.set("text",a)},setLink:function(){var b,a=this.currentImage.getParent();if(a.get("tag")==="a"){b=a.clone(false).cloneEvents(a);b.replaces(this.linkHolder);this.linkHolder=b;this.linkHolder.addClass("nivoo-link").setStyle("display","block")}else{this.linkHolder.setStyle("display","none")}},finish:function(){this.fireEvent("finish")},lastSlide:function(){this.fireEvent("lastSlide")},start:function(){this.fireEvent("start")}});